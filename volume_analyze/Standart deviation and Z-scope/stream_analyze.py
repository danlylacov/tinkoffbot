from standart_deviation import StandartDeviation
from stream_parser.parser import stream_parse
import time


if __name__ == '__main__':
    historic_data = [3791, 4095, 3444, 8003, 2954, 5446, 3478, 3154, 3376, 10139, 2855, 9574, 1739, 6410, 2170, 9319,
                     12502, 3061, 4106, 9387, 17790, 6913, 11443, 21240, 5096, 3763, 13276, 154512, 85910, 38936, 30638,
                     21744, 59861, 8468, 31510, 14073, 5065, 8286, 25343, 14750, 24016, 31100, 10056, 8441, 23366,
                     11539, 4187, 18687, 5953, 11714, 4516, 20392, 5500, 1987, 6811, 6677, 21697, 12239, 27383, 11670,
                     7321, 12175, 22199, 5307, 9544, 807, 8223, 7462, 6592, 13363, 14871, 34651, 32880, 17839, 12369,
                     29263, 19106, 27824, 8222, 4551, 2967, 4296, 3158, 5462, 7209, 3423, 2542, 7152, 1339, 3021, 617,
                     1062, 2058, 1720, 815, 4450, 3439, 3962, 3361, 4506, 3252, 1715, 2036, 1630, 1293, 3051, 1570,
                     3821, 16711, 5486, 9707, 4734, 2022, 2247, 4743, 1930, 1465, 1248, 2423, 1531, 2292, 1571, 7872,
                     64478, 39621, 34532, 28485, 55799, 61531, 59840, 47559, 37273, 28107, 14622, 17072, 9703, 28152,
                     47853, 20318, 12310, 10748, 12906, 16930, 5422, 4450, 6539, 6149, 13265, 8608, 8282, 6644, 12647,
                     6431, 42053, 23498, 38228, 12085, 11855, 14767, 14704, 6816, 6021, 9553, 6670, 4630, 8048, 5395,
                     4389, 3897, 3168, 4207, 8780, 12916, 5641, 17128, 10771, 5086, 3672, 23213, 38512, 19840, 21681,
                     5902, 26468, 17263, 27440, 38282, 32630, 8972, 6866, 15579, 4130, 7804, 12453, 4855, 8904, 53508,
                     46731, 96886, 21109, 33451, 15296, 14766, 20840, 12237, 7438, 65836, 43084, 22349, 36592, 10110,
                     16134, 26107, 9935, 11532, 10912, 10658, 6995, 4463, 8490, 6628, 8515, 14899, 20257, 6683, 5013,
                     5006, 12493, 219, 3184, 3854, 3868, 2338, 1456, 4996, 1126, 6765, 2283, 3393, 1697, 3886, 972,
                     2215, 1538, 1496, 655, 1717, 3867, 7577, 1526, 1354, 2012, 1882, 891, 2241, 2607, 1754, 1019, 981,
                     3655, 740, 1112, 985, 3088, 5380, 8970, 2599, 2732, 5102, 1527, 1429, 1340, 2280, 1033, 1699, 2572,
                     2093, 1850, 1508, 790, 2097, 1614, 906, 2704, 6714, 3651, 27261, 16027, 8711, 11386, 20346, 2798,
                     3665, 7793, 19564, 9701, 4486, 8916, 10745, 13706, 18825, 7720, 14369, 4022, 2877, 4169, 5277,
                     10444, 11441, 15153, 6319, 8577, 34934, 24530, 13820, 5599, 3718, 10438, 7891, 3120, 14807, 21421,
                     10735, 6721, 5409, 4379, 4064, 4560, 1643, 5566, 3979, 4226, 1690, 2391, 1606, 2791, 12945, 4583,
                     1629, 2314, 2691, 8141, 16088, 10116, 15704, 11816, 5172, 2014, 10063, 6284, 4002, 3223, 4236,
                     2535, 4034, 3512, 2348, 4581, 2646, 18614, 3529, 4031, 9230, 5590, 1401, 6159, 2333, 5060, 1260,
                     1457, 2642, 2836, 1724, 4979, 4080, 2323, 3110, 1847, 1257, 2858, 2056, 4703, 3110, 4625, 2015,
                     2026, 1847, 2312, 4806, 1206, 11003, 47, 1496, 2071, 2900, 2810, 902, 1562, 1406, 1039, 338, 484,
                     697, 655, 623, 4404, 879, 1131, 757, 507, 339, 838, 1108, 1052, 697, 1208, 997, 773, 652, 5683,
                     1504, 835, 1995, 1448, 1140, 676, 1050, 1351, 2364, 847, 1973, 757, 882, 903, 1232, 598, 720, 1149,
                     443, 668, 2525, 2541, 2347, 1552, 1931, 970, 1484, 1781, 4302, 17635, 4866, 5699, 9022, 11057,
                     17389, 4540, 4216, 3079, 7821, 9822, 8450, 25418, 10454, 11576, 9431, 5134, 4438, 5273, 14198,
                     5613, 3431, 2954, 4672, 2139, 11401, 5276, 3789, 5028, 3331, 11029, 6258, 6716, 7297, 4562, 3362,
                     2767, 1567, 14326, 7422, 7066, 7901, 6674, 2513, 2560, 3487, 8867, 34303, 6664, 4116, 4122, 4624,
                     4555, 6610, 9641, 3057, 7044, 6608, 5459, 3500, 3428, 2391, 5449, 4886, 3540, 4764, 2188, 2499,
                     2832, 5368, 2150, 2707, 2812, 2961, 3346, 3019, 4343, 1829, 2115, 2587, 2882, 4383, 6618, 12337,
                     14868, 6012, 2661, 3330, 3102, 3491, 2984, 4110, 2874, 4294, 2310, 6557, 7833, 4105, 5681, 3109,
                     13809, 4973, 2186, 917, 4735, 137, 3414, 1250, 944, 3804, 480, 457, 875, 2493, 266, 877, 550, 1073,
                     978, 645, 471, 2746, 347, 517, 310, 331, 477, 366, 518, 474, 427, 1253, 2148, 580, 856, 659, 846,
                     2687, 355, 724, 1040, 216, 1581, 1455, 1477, 657, 1352, 1125, 1047, 436, 676, 412, 666, 770, 1971,
                     993, 3131, 843, 2145, 1063, 2081, 7217, 3403, 130, 199, 163, 117, 75, 65, 262, 17, 39, 35, 177, 73,
                     99, 37, 79, 53, 92, 22, 81, 225, 40, 66, 35, 49, 24, 43, 17, 42, 301, 110, 25, 162, 40, 54, 116,
                     11, 20, 31, 20, 34, 48, 31, 118, 32, 40, 14, 62, 143, 56, 18, 34, 34, 65, 19, 30, 48, 45, 42, 25,
                     23, 30, 22, 47, 30, 12, 8, 25, 13, 27, 38, 41, 73, 59, 13, 21, 27, 12, 28, 76, 27, 13, 28, 11, 92,
                     29, 13, 3, 20, 20, 86, 33, 22, 3, 20, 4, 191, 6, 59, 51, 54, 79, 10, 17, 15, 71, 8, 58, 22, 38, 2,
                     65, 67, 59, 46, 15, 39, 75, 40, 12, 84, 135, 55, 33, 62, 21, 23, 57, 15, 22, 19, 34, 59, 8, 22, 74,
                     6, 24, 44, 11, 17, 49, 9, 27, 42, 53, 21, 15, 44, 42, 22, 32, 120, 94, 63, 18, 33, 6, 14, 43, 30,
                     17, 15, 16, 51, 11, 18, 30, 18, 46, 8, 11, 12, 10, 20, 5, 20, 17, 16, 23, 8, 34, 101, 52, 6, 26,
                     23, 35, 49, 15, 15, 4, 19, 11, 107, 16, 34, 5, 31, 26, 65, 9, 21, 19, 9, 2, 120, 4, 14, 11, 7, 33,
                     56, 41, 17, 11, 14, 42142, 12085, 12551, 11063, 9143, 12599, 12313, 13140, 10151, 8708, 14721,
                     8019, 3655, 9868, 2673, 9352, 2450, 5120, 4027, 12181, 7797, 4040, 6679, 15717, 4494, 6369, 5019,
                     2616, 10192, 8722, 2019, 5612, 2116, 2348, 6876, 5934, 4962, 15888, 9737, 2782, 4547, 5515, 2112,
                     1330, 1357, 1393, 3914, 1950, 1961, 2343, 1971, 9026, 2586, 2204, 1078, 5309, 2805, 1336, 3062,
                     2675, 8197, 3576, 1925, 1526, 2203, 2499, 4332, 1964, 4499, 4657, 4012, 5099, 1008, 4920, 3044,
                     1753, 6657, 2967, 1504, 5571, 3179, 2270, 4258, 2600, 5313, 2193, 5976, 5731, 2032, 3976, 1918,
                     1845, 8110, 9191, 5370, 4460, 8726, 5301, 3814, 6589, 6351, 3355, 1873, 2394, 5469, 136, 4416,
                     1936, 1457, 2518, 2449, 1193, 7690, 912, 2131, 1111, 368, 688, 407, 611, 842, 270, 778, 883, 1188,
                     158, 750, 2233, 484, 383, 820, 1040, 2609, 1776, 1198, 393, 351, 1806, 1601, 485, 725, 1076, 492,
                     1083, 393, 422, 651, 1335, 1230, 297, 1308, 631, 507, 1128, 441, 847, 1032, 263, 353, 395, 997,
                     1399, 1209, 18350, 7753, 11572, 8789, 12812, 28371, 9446, 10028, 11756, 13422, 10600, 7152, 8205,
                     8789, 5325, 3818, 4935, 3304, 6558, 4198, 26992, 12510, 3776, 13201, 50878, 20137, 73152, 42180,
                     25332, 29863, 13513, 61446, 38218, 29271, 15952, 14446, 12178, 14232, 18929, 22743, 2043]

    f = open('lycoil.txt', 'w', encoding='utf-8')

    print('Server Started!')

    while True:
        candle1 = str(stream_parse()[0])
        candle = candle1.split(',')
        candle = [candle[0].split('=')[2], candle[2].split('=')[2], candle[4].split('=')[2], candle[6].split('=')[2],
                  candle[8].split('=')[1],
                  f"{candle[9].split('(')[1].strip()}:{candle[10].strip()}:{candle[11].strip()}:{candle[12].strip()}:{candle[13].strip()}"]
        stream_volume = int(candle[4])

        lycoil = StandartDeviation(historic_data, stream_volume, 3)
        historic_data.append(stream_volume)
        f.write(str(lycoil.result) +'  ' +  candle1 + '\n')
        print(lycoil.result, candle1)
        time.sleep(60*5)
